<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字测评系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .batch-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 14px;
            margin-bottom: 20px;
            font-family: inherit;
            resize: vertical;
        }

        .batch-input::placeholder {
            color: #adb5bd;
        }

        .input-mode-switch {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .mode-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
        }

        .result-section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .result-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #667eea;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-card.error {
            border-left-color: #f44336;
            background: #fff8f8;
        }

        .result-card.info {
            border-left-color: #2196F3;
            background: #f8fbff;
        }

        .format-example {
            padding: 8px 12px;
            background: #f5f5f5;
            border-radius: 6px;
            margin: 4px 0;
            font-family: monospace;
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }

        input, select {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .calculate-btn {
            background: linear-gradient(135deg, #667eea);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .bazi-table {
            width: auto;
            margin: 20px 0;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .pillar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            margin-bottom: 10px;
            color: #666;
            font-size: 14px;
        }

        .pillar-header span {
            flex: 1;
            text-align: center;
        }

        .pillar-container {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            padding: 0 10px;
        }

        .pillar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .pillar-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .bazi-table th {
            background-color: #667eea;
            color: white;
            padding: 12px 20px;
            text-align: center;
        }

        .bazi-table td {
            padding: 12px 20px;
            text-align: center;
            border-bottom: 1px solid #eee;
            white-space: nowrap;
        }

        .element {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 5px;
        }

        .wood { background: #4caf50; color: white; }
        .fire { background: #f44336; color: white; }
        .earth { background: #ff9800; color: white; }
        .metal { background: #9e9e9e; color: white; }
        .water { background: #2196f3; color: white; }

        .analysis-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 3px solid #ff6b6b;
        }

        .analysis-item.positive {
            border-left-color: #4caf50;
            background: #e8f5e8;
        }

        .adjustment-section {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .adjustment-section h4 {
            margin-bottom: 10px;
        }

        .zodiac-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
        }

        .zodiac-emoji {
            font-size: 24px;
        }

        @media (max-width: 768px) {
            .input-group {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 2em;
            }
            .main-content {
                padding: 20px;
            }
        }

        /* 参考图表样式 */
        .lookup-container {
            display: none;
            background: #f8f9fa;
            padding: 5px;
            border-radius: 15px;
            margin-top: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        .lookup-container h3 {
            text-align: center;
            margin-bottom: 10px;
            color: #333;
        }
        .lookup-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .lookup-table th, .lookup-table td {
            border: 1px solid #ddd;
            padding: 8px 10px;
            text-align: center;
        }
        .lookup-table th {
            font-weight: 600;
        }
        .shichen-table td strong {
            display: block;
        }
        .xiongshu-header {
            color: white;
            font-weight: bold;
        }
        .bajue-header { background-color: #b3f803; } /* yellowgreen */
        .liuchong-header { background-color: #00b6f3; } /* lightblue */
        .shuangmu-header { background-color: #e9d900; } /* khaki */
        .zhongliu-header { background-color: #fc580c; } /* turquoise */

        .xiongshu-tables-container {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }
        .xiongshu-tables-container > div {
            flex: 1;
        }

        /* 添加高亮样式 */
        .highlight-combination {
            display: inline-block;
            padding: 2px 4px;
            border: 1px solid red;
            border-radius: 3px;
            line-height: 1;
        }

        .horizontal-line {
            width: 30px;
            height: 2px;
            background: #333;
            display: inline-block;
        }

        .element-tag {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            margin-left: 2px;
        }
    </style>
</head>
<body>
    <div id="protected-content" style="visibility: hidden;">
        <div class="container">
            <div class="header">
                <h1>🌟 八字测评系统 🌟</h1>
                <p>传统命理学与现代技术的完美结合</p>
            </div>

            <div class="main-content">
                <div class="input-section">
                    <div class="input-mode-switch">
                        <button class="mode-btn active" onclick="switchMode('single')" id="singleModeBtn">单个八字 (禁用) </button>
                        <button class="mode-btn " onclick="switchMode('batch')" id="batchModeBtn">批量八字（推荐）</button>
                    </div>
                    
                    <div id="singleInputMode" >
                        <h2 style="margin-bottom: 25px; color: #333;">📅 请输入您的出生信息</h2>
                    <div class="input-group">
                        <div class="form-group">
                            <label for="year">出生年份</label>
                            <input type="number" id="year" placeholder="例如：1999" min="1900" max="2030">
                        </div>
                        <div class="form-group">
                            <label for="month">出生月份</label>
                            <select id="month">
                                <option value="">请选择月份</option>
                                <option value="1">正月</option>
                                <option value="2">二月</option>
                                <option value="3">三月</option>
                                <option value="4">四月</option>
                                <option value="5">五月</option>
                                <option value="6">六月</option>
                                <option value="7">七月</option>
                                <option value="8">八月</option>
                                <option value="9">九月</option>
                                <option value="10">十月</option>
                                <option value="11">冬月</option>
                                <option value="12">腊月</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="day">出生日期</label>
                            <input type="number" id="day" placeholder="例如：15" min="1" max="31">
                        </div>
                        <div class="form-group">
                            <label for="hour">出生时间</label>
                            <select id="hour">
                                <option value="">请选择时辰</option>
                                <option value="1">子时 (23:00-01:00)</option>
                                <option value="2">丑时 (01:00-03:00)</option>
                                <option value="3">寅时 (03:00-05:00)</option>
                                <option value="4">卯时 (05:00-07:00)</option>
                                <option value="5">辰时 (07:00-09:00)</option>
                                <option value="6">巳时 (09:00-11:00)</option>
                                <option value="7">午时 (11:00-13:00)</option>
                                <option value="8">未时 (13:00-15:00)</option>
                                <option value="9">申时 (15:00-17:00)</option>
                                <option value="10">酉时 (17:00-19:00)</option>
                                <option value="11">戌时 (19:00-21:00)</option>
                                <option value="12">亥时 (21:00-23:00)</option>
                            </select>
                            </div>
                        </div>
                    </div>

                    <div id="batchInputMode" style="display: none;">
                        <h2 style="margin-bottom: 25px; color: #333;">📑 批量八字排盘</h2>
                        <textarea class="batch-input" id="batchInput" placeholder="请输入待排盘的日期时间，每行一个。支持以下格式：
1999年正月初二早上9点
2000年3月15日下午2点
1988年腊月二十三晚上11点
2023年冬月初八上午10点
1999.1.13辰时"></textarea>
                    </div>

                    <div style="text-align: center; margin-top: 25px;">
                        <button class="calculate-btn" onclick="calculateBazi()" id="singleCalcBtn">🔮 开始测评</button>
                        <button class="calculate-btn" onclick="calculateBatchBazi()" id="batchCalcBtn" style="display: none;">🔮 批量测评</button>
                        <button class="calculate-btn" onclick="toggleLookupTables()" style="background: linear-gradient(135deg, #4caf50, #81c784); margin-left: 15px;">📖 查看参考图表</button>
                    </div>
                </div>

                <div class="result-section" id="resultSection">
                    <div class="result-grid" id="resultGrid">
                    <!-- 结果将在这里显示 -->
                    </div>
                </div>

                 <div class="lookup-container" id="lookupTablesContainer">
                    <table class="lookup-table shichen-table">
                        <tbody>
                            <tr>
                                <td><strong>子时-1</strong>23:00-1:00</td>
                                <td><strong>丑时-2</strong>1:00-3:00</td>
                                <td><strong>寅时-3</strong>3:00-5:00</td>
                                <td><strong>卯时-4</strong>5:00-7:00</td>
                                <td><strong>辰时-5</strong>7:00-9:00</td>
                                <td><strong>巳时-6</strong>9:00-11:00</td>
                            </tr>
                            <tr>
                                <td><strong>午时-7</strong>11:00-13:00</td>
                                <td><strong>未时-8</strong>13:00-15:00</td>
                                <td><strong>申时-9</strong>15:00-17:00</td>
                                <td><strong>酉时-10</strong>17:00-19:00</td>
                                <td><strong>戌时-11</strong>19:00-21:00</td>
                                <td><strong>亥时-12</strong>21:00-23:00</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="xiongshu-tables-container">
                        <div>
                            <table class="lookup-table">
                                <thead><tr><th colspan="2" class="xiongshu-header bajue-header">八绝数组</th></tr></thead>
                                <tbody>
                                    <tr><td>1-8</td><td>8-1</td></tr>
                                    <tr><td>1-9</td><td>9-1</td></tr>
                                    <tr><td>6-2</td><td>2-6</td></tr>
                                    <tr><td>3-5</td><td>5-3</td></tr>
                                    <tr><td>3-6</td><td>6-3</td></tr>
                                    <tr><td>4-10</td><td>10-4</td></tr>
                                    <tr><td>11-7</td><td>7-11</td></tr>
                                    <tr><td>7-12</td><td>12-7</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div>
                            <table class="lookup-table">
                                <thead><tr><th colspan="2" class="xiongshu-header liuchong-header">六冲数组</th></tr></thead>
                                <tbody>
                                    <tr><td>1-7</td><td>7-1</td></tr>
                                    <tr><td>8-2</td><td>2-8</td></tr>
                                    <tr><td>3-9</td><td>9-3</td></tr>
                                    <tr><td>10-4</td><td>4-10</td></tr>
                                    <tr><td>11-5</td><td>5-11</td></tr>
                                    <tr><td>12-6</td><td>6-12</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div>
                            <table class="lookup-table">
                                 <thead><tr><th colspan="2" class="xiongshu-header shuangmu-header">双木克土</th></tr></thead>
                                <tbody>
                                    <tr><td>3-8-4</td><td>3-8-5</td></tr>
                                    <tr><td>3-9-4</td><td>3-9-5</td></tr>
                                    <tr><td>4-3-4</td><td>4-3-5</td></tr>
                                    <tr><td>4-8-5</td><td>4-9-5</td></tr>
                                    <tr><td>4-8-4</td><td>4-9-4</td></tr>
                                    <tr><td>5-8-5</td><td>5-9-5</td></tr>
                                    <tr><td>5-3-5</td><td></td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div>
                            <table class="lookup-table">
                                <thead><tr><th class="xiongshu-header zhongliu-header">肿瘤数字</th></tr></thead>
                                <tbody>
                                    <tr><td>3-3</td></tr>
                                    <tr><td>3-9</td></tr>
                                    <tr><td>6-3</td></tr>
                                    <tr><td>7-3</td></tr>
                                    <tr><td>9-3</td></tr>
                                    <tr><td>9-9</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <footer>
                <p style="text-align: center;">免责声明：本工具仅供娱乐和参考，请勿用于决策依据。反馈-->王昭阳：wq483489278</p>
            </footer>
        </div>
    </div>

    <script>
        function calculateLowerNumber(upperNumber) {
            // 如果上卦数字大于6，减去6；如果小于等于6，加上6
            return upperNumber > 6 ? upperNumber - 6 : upperNumber + 6;
        }

        function switchMode(mode) {
            const singleMode = document.getElementById('singleInputMode');
            const batchMode = document.getElementById('batchInputMode');
            const singleBtn = document.getElementById('singleModeBtn');
            const batchBtn = document.getElementById('batchModeBtn');
            const singleCalcBtn = document.getElementById('singleCalcBtn');
            const batchCalcBtn = document.getElementById('batchCalcBtn');

            if (mode === 'single') {
                singleMode.style.display = 'block';
                batchMode.style.display = 'none';
                singleBtn.classList.add('active');
                batchBtn.classList.remove('active');
                singleCalcBtn.style.display = 'inline-block';
                batchCalcBtn.style.display = 'none';
            } else {
                singleMode.style.display = 'none';
                batchMode.style.display = 'block';
                singleBtn.classList.remove('active');
                batchBtn.classList.add('active');
                singleCalcBtn.style.display = 'none';
                batchCalcBtn.style.display = 'inline-block';
            }
        }

        function toggleLookupTables() {
            const container = document.getElementById('lookupTablesContainer');
            if (container.style.display === 'none' || container.style.display === '') {
                container.style.display = 'block';
                container.scrollIntoView({ behavior: 'smooth' });
            } else {
                container.style.display = 'none';
            }
        }

        // 数字组合定义
        // 八绝数组
        const baJue = [
            [1,8], [1,9], [6,2], [3,5], [3,6], [4,10], [11,7], [7,12],
            [8,1], [9,1], [2,6], [5,3], [6,3], [10,4], [7,11], [12,7]
        ];

        // 六冲数组
        const liuChong = [
            [1,7], [8,2], [3,9], [10,4], [11,5], [12,6],
            [7,1], [2,8], [9,3], [4,10], [5,11], [6,12]
        ];

        // 双木克土
        const shuangMuKeTu = [
            [3,8,4], [3,9,4], [4,3,4], [4,8,5], [4,8,4], [5,8,5],
            [3,8,5], [3,9,5], [4,3,5], [4,9,5], [4,9,4], [5,9,5], [5,3,5]
        ];

        // 肿瘤数字
        const zhongLiu = [[3,3], [3,9], [6,3], [7,3], [9,3], [9,9]];

        // 生肖数据
        const zodiacData = {
            1: { name: '子鼠', emoji: '🐭' },
            2: { name: '丑牛', emoji: '🐮' },
            3: { name: '寅虎', emoji: '🐯' },
            4: { name: '卯兔', emoji: '🐰' },
            5: { name: '辰龙', emoji: '🐲' },
            6: { name: '巳蛇', emoji: '🐍' },
            7: { name: '午马', emoji: '🐴' },
            8: { name: '未羊', emoji: '🐑' },
            9: { name: '申猴', emoji: '🐵' },
            10: { name: '酉鸡', emoji: '🐔' },
            11: { name: '戌狗', emoji: '🐕' },
            12: { name: '亥猪', emoji: '🐷' }
        };

        // 简化为纯数字五行对应关系
        function getElementForNumber(num) {
            const numberElements = {
                1: '水',
                2: '水',
                3: '土',
                4: '木',
                5: '木',
                6: '火',
                7: '火',
                8: '土',
                9: '土',
                10: '金',
                11: '金',
                12: '水'
            };
            return numberElements[num] || '未知';
        }

        // 五行对应的颜色
        function getElementClass(element) {
            const elementColors = {
                '木': '#4CAF50',  // 绿色
                '火': '#F44336',  // 红色
                '土': '#FF9800',  // 橙色
                '金': '#9E9E9E',  // 灰色
                '水': '#2196F3'   // 蓝色
            };
            return elementColors[element] || '#000000';
        }

        function calculateBazi() {
            const year = parseInt(document.getElementById('year').value);
            const month = parseInt(document.getElementById('month').value);
            const day = parseInt(document.getElementById('day').value);
            const hour = parseInt(document.getElementById('hour').value);

            if (!year || !month || !day || !hour) {
                alert('请填写完整的出生信息！');
                return;
            }

            // 计算生肖排名
            const zodiacIndex = ((year - 4) % 12) + 1;
            const zodiacRank = zodiacIndex <= 0 ? zodiacIndex + 12 : zodiacIndex;

            // 计算上卦
            const upperGua = {
                year: zodiacRank,  // 使用生肖排名
                month: month,
                day: day <= 12 ? [day] : splitDayNumber(day),  // 使用辅助函数拆分日期
                hour: hour
            };

            // 计算下卦（按照上卦数字±6的规则）
            const lowerGua = {
                year: calculateLowerNumber(upperGua.year),
                month: calculateLowerNumber(upperGua.month),
                day: upperGua.day.map(d => calculateLowerNumber(d)),
                hour: calculateLowerNumber(upperGua.hour)
            };

            // 显示结果
            displayResults(year, zodiacRank, upperGua, lowerGua);
        }

        // 农历月份映射
        const lunarMonths = {
            '正': 1, '二': 2, '三': 3, '四': 4, '五': 5, '六': 6,
            '七': 7, '八': 8, '九': 9, '十': 10, '冬': 11, '腊': 12
        };

        // 农历日期映射
        const lunarDays = {
            '初一': 1, '初二': 2, '初三': 3, '初四': 4, '初五': 5,
            '初六': 6, '初七': 7, '初八': 8, '初九': 9, '初十': 10,
            '十一': 11, '十二': 12, '十三': 13, '十四': 14, '十五': 15,
            '十六': 16, '十七': 17, '十八': 18, '十九': 19, '二十': 20,
            '廿一': 21, '廿一': 21, '廿二': 22, '二十二': 22, 
            '廿三': 23, '二十三': 23, '廿四': 24, '二十四': 24,
            '廿五': 25, '二十五': 25, '廿六': 26, '二十六': 26,
            '廿七': 27, '二十七': 27, '廿八': 28, '二十八': 28,
            '廿九': 29, '二十九': 29, '三十': 30
        };

        // 时辰映射
        const timeMap = {
            '子时': 1, '丑时': 2, '寅时': 3, '卯时': 4, '辰时': 5, '巳时': 6,
            '午时': 7, '未时': 8, '申时': 9, '酉时': 10, '戌时': 11, '亥时': 12
        };

        function splitDayNumber(day) {
            if (day <= 12) return [day];
            
            // 处理日期拆分
            const result = [];
            
            if (day % 10 === 0) {
                // 处理整十数（20、30）
                result.push(Math.floor(day / 10)); // 十位数
                result.push(10);                   // 补充10
            } else {
                // 处理其他数字（13-19, 21-29, 31）
                result.push(Math.floor(day / 10)); // 十位数
                result.push(10);                   // 中间补充10
                result.push(day % 10);            // 个位数
            }
            
            return result;
        }

        function parseDateString(dateStr) {
            try {
                let year, month, day, hour;
                
                // 处理不同的日期格式
                if (dateStr.includes('.')) {
                    // 处理 1999.1.13辰时 格式
                    const parts = dateStr.split('.');
                    if (parts.length !== 3) throw new Error('格式错误：应为"年.月.日 时辰"格式');
                    
                    year = parseInt(parts[0]);
                    month = parseInt(parts[1]);
                    
                    // 分割日期和时辰
                    const dayAndTime = parts[2].trim().split(/\s+/);
                    if (dayAndTime.length !== 2) throw new Error('格式错误：日期和时辰之间需要空格分隔');
                    
                    day = parseInt(dayAndTime[0]);
                    const timeStr = dayAndTime[1];
                    
                    // 检查时辰格式
                    if (!timeStr.match(/[子丑寅卯辰巳午未申酉戌亥]时/)) {
                        throw new Error('时辰格式错误：应为"子时/丑时/..."等格式');
                    }
                    
                    hour = timeMap[timeStr];
                } else if (dateStr.match(/\d{4}年\d{1,2}月\d{1,2}日/)) {
                    // 处理 2000年3月15日下午2点 格式
                    const yearMatch = dateStr.match(/(\d{4})年/);
                    const monthMatch = dateStr.match(/(\d{1,2})月/);
                    const dayMatch = dateStr.match(/(\d{1,2})日/);
                    
                    year = yearMatch ? parseInt(yearMatch[1]) : null;
                    month = monthMatch ? parseInt(monthMatch[1]) : null;
                    day = dayMatch ? parseInt(dayMatch[1]) : null;
                    
                    // 提取时间部分
                    const timeStr = dateStr.substring(dateStr.indexOf('日') + 1).trim();
                    hour = convertTimeToHour(timeStr);
                } else {
                    // 处理农历格式
                    const yearMatch = dateStr.match(/(\d{4})年/);
                    year = yearMatch ? parseInt(yearMatch[1]) : null;

                    // 匹配月份
                    const monthMatch = dateStr.match(/([正二三四五六七八九十冬腊])月/);
                    month = monthMatch ? lunarMonths[monthMatch[1]] : null;

                    // 匹配日期（支持"二十三"和"廿三"两种写法）
                    let dayMatch = dateStr.match(/(初[一二三四五六七八九十]|十[一二三四五六七八九]|二十[一二三四五六七八九]?|廿[一二三四五六七八九]|三十)/);
                    let dayNum = dayMatch ? lunarDays[dayMatch[1]] : null;

                    // 匹配时间
                    const timeStr = dateStr.substring(dateStr.indexOf('月') + 1).trim();
                    if (timeStr.includes('时')) {
                        const timeMatch = timeStr.match(/([子丑寅卯辰巳午未申酉戌亥])时/);
                        hour = timeMatch ? timeMap[timeMatch[0]] : null;
                    } else {
                        hour = convertTimeToHour(timeStr);
                    }

                    // 设置日期
                    day = dayNum;
                }

                // 验证所有必需的值都已获取
                if (!year || !month || !day || !hour) {
                    throw new Error('无法解析完整的日期时间信息');
                }

                // 验证值的合理性
                if (year < 1900 || year > 2100) throw new Error('年份超出范围(1900-2100)');
                if (month < 1 || month > 12) throw new Error('月份超出范围(1-12)');
                if (day < 1 || day > 31) throw new Error('日期超出范围(1-31)');
                if (hour < 1 || hour > 12) throw new Error('时辰超出范围(1-12)');

                return { year, month, day, hour };
            } catch (error) {
                console.error(`解析日期时出错: ${dateStr}`, error);
                return { error: error.message || '格式错误' };
            }
        }

        function convertTimeToHour(timeStr) {
            if (!timeStr) return null;

            // 如果已经是时辰格式，直接返回对应的数字
            if (timeStr.match(/[子丑寅卯辰巳午未申酉戌亥]时/)) {
                return timeMap[timeStr];
            }

            // 处理早上/上午/下午/晚上 + 具体时间
            const timeMatch = timeStr.match(/(早上|上午|下午|晚上)?.*?(\d{1,2})[点时]/);
            if (!timeMatch) return null;

            let hour = parseInt(timeMatch[2]);
            const period = timeMatch[1];

            // 根据时间段调整小时数
            if (period === '下午' || period === '晚上') {
                if (hour < 12) hour += 12;
            } else if ((period === '早上' || period === '上午') && hour === 12) {
                hour = 0;
            }

            // 转换为时辰（每个时辰管2个小时）
            // 子时（23:00-1:00）开始，按照2小时一个时辰计算
            hour = (hour + 1) % 24;  // 调整到0-23范围
            return Math.floor(hour / 2) + 1;
        }

        function calculateBatchBazi() {
            const input = document.getElementById('batchInput').value;
            const dates = input.split('\n').filter(line => line.trim());
            
            const resultGrid = document.getElementById('resultGrid');
            resultGrid.innerHTML = ''; // 清空现有结果

            let hasError = false;
            dates.forEach((dateStr, index) => {
                const parsedDate = parseDateString(dateStr.trim());
                
                // 添加分隔线（除了第一个结果）
                if (index > 0) {
                    const divider = document.createElement('hr');
                    divider.style.margin = '20px 0';
                    divider.style.border = 'none';
                    divider.style.borderTop = '1px dashed #ddd';
                    resultGrid.appendChild(divider);
                }

                if (!parsedDate.error) {
                    const { year, month, day, hour } = parsedDate;
                    // 计算单个八字
                    const zodiacIndex = ((year - 4) % 12) + 1;
                    const zodiacRank = zodiacIndex <= 0 ? zodiacIndex + 12 : zodiacIndex;

                    // 处理日柱拆分
                    const dayNumbers = splitDayNumber(day);

                    const upperGua = {
                        year: zodiacRank,
                        month: month,
                        day: dayNumbers,
                        hour: hour
                    };

                    const lowerGua = {
                        year: calculateLowerNumber(upperGua.year),
                        month: calculateLowerNumber(upperGua.month),
                        day: dayNumbers.map(d => calculateLowerNumber(d)),
                        hour: calculateLowerNumber(upperGua.hour)
                    };

                    // 创建结果卡片
                    const resultCard = document.createElement('div');
                    resultCard.className = 'result-card';
                    resultCard.innerHTML = generateResultHTML(year, zodiacRank, upperGua, lowerGua, dateStr);
                    resultGrid.appendChild(resultCard);
                } else {
                    // 创建错误提示卡片
                    const errorCard = document.createElement('div');
                    errorCard.className = 'result-card error';
                    errorCard.innerHTML = `
                        <h3 style="color: #f44336;">❌ 解析错误</h3>
                        <p>无法解析日期：${dateStr}</p>
                        <p style="font-size: 0.9em; color: #666;">${parsedDate.error}</p>
                        <div style="margin-top: 10px;">
                            <p style="font-weight: bold;">正确格式示例：</p>
                            <div class="format-example">1999.1.13 辰时</div>
                            <div class="format-example">2000年3月15日下午2点</div>
                            <div class="format-example">1988年腊月二十三晚上11点</div>
                        </div>
                    `;
                    resultGrid.appendChild(errorCard);
                    hasError = true;
                }
            });

            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generateResultHTML(year, zodiacRank, upperGua, lowerGua, originalDate) {
            const zodiac = zodiacData[zodiacRank];
            const upperAnalyses = analyzeGua(upperGua, '上卦');
            const lowerAnalyses = analyzeGua(lowerGua, '下卦');

            // 收集所有需要高亮的数字组合
            const highlightCombinations = new Set();
            const allAnalyses = [upperAnalyses, lowerAnalyses].filter(Boolean);
            
            allAnalyses.forEach(analysis => {
                const matches = analysis.match(/\d+-\d+(?:-\d+)?/g) || [];
                matches.forEach(match => highlightCombinations.add(match));
            });

            // 五行分析
            const allNumbers = [
                upperGua.year, upperGua.month, ...upperGua.day, upperGua.hour,
                lowerGua.year, lowerGua.month, ...lowerGua.day, lowerGua.hour
            ];
            const allElements = allNumbers.map(num => getElementForNumber(num));
            const elementAnalyses = [];
            if (!allElements.includes('土')) {
                elementAnalyses.push('五行缺土，没有财库');
            }
            if (!allElements.includes('金')) {
                elementAnalyses.push('五行缺金，财运受阻');
            }
            
            return `
                <h3>🎯 ${originalDate}</h3>
                <div class="zodiac-info">
                    <span class="zodiac-emoji">${zodiac.emoji}</span>
                    <div>
                        <strong>${year}年生人</strong><br>
                        <span style="color: #666;">生肖：${zodiac.name}（排名：${zodiacRank}）</span>
                    </div>
                </div>
                <!-- 八字排盘表格 -->
                ${generateBaziTableHTML(upperGua, lowerGua)}
                <!-- 分析结果 -->
                <div class="analysis-summary" style="padding: 15px 25px; text-align: left; line-height: 1.8;">
                    ${upperAnalyses ? `<p style="color: #c9302c;"><strong>上卦： ${upperAnalyses}</p>` : ''}</strong>
                    ${lowerAnalyses ? `<p style="color: #c9302c;"><strong>下卦：${lowerAnalyses}</p>` : ''}</strong> 
                    ${elementAnalyses.length > 0 ? `<p style="color: #c9302c;"><strong>五行分析：</strong> ${elementAnalyses.join('、')}</p>` : ''}
                    ${!upperAnalyses && !lowerAnalyses && elementAnalyses.length === 0 ? '<div class="analysis-item positive" style="text-align:center;">✨ 八字平和，无明显冲克</div>' : ''}
                </div>
                <!-- 时辰对照表 -->
                <div class="time-reference" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
                    <h4 style="margin-bottom: 10px;">时辰对照表</h4>
                    <table class="lookup-table shichen-table">
                        <tbody>
                            <tr>
                                <td><strong>子时-1</strong>23:00-1:00</td>
                                <td><strong>丑时-2</strong>1:00-3:00</td>
                                <td><strong>寅时-3</strong>3:00-5:00</td>
                                <td><strong>卯时-4</strong>5:00-7:00</td>
                                <td><strong>辰时-5</strong>7:00-9:00</td>
                                <td><strong>巳时-6</strong>9:00-11:00</td>
                            </tr>
                            <tr>
                                <td><strong>午时-7</strong>11:00-13:00</td>
                                <td><strong>未时-8</strong>13:00-15:00</td>
                                <td><strong>申时-9</strong>15:00-17:00</td>
                                <td><strong>酉时-10</strong>17:00-19:00</td>
                                <td><strong>戌时-11</strong>19:00-21:00</td>
                                <td><strong>亥时-12</strong>21:00-23:00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- 凶数对照表 -->
                <div class="xiongshu-tables-container" style="margin-top: 20px;">
                    <div>
                        <table class="lookup-table">
                            <thead>
                                <tr><th colspan="2" class="xiongshu-header bajue-header">八绝数组</th></tr>
                            </thead>
                            <tbody>
                                ${[
                                    ['1-8', '8-1'], ['1-9', '9-1'], ['6-2', '2-6'],
                                    ['3-5', '5-3'], ['3-6', '6-3'], ['4-10', '10-4'],
                                    ['11-7', '7-11'], ['7-12', '12-7']
                                ].map(row => `
                                    <tr>
                                        <td>${highlightCombinations.has(row[0]) ? `<span class="highlight-combination">${row[0]}</span>` : row[0]}</td>
                                        <td>${highlightCombinations.has(row[1]) ? `<span class="highlight-combination">${row[1]}</span>` : row[1]}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <table class="lookup-table">
                            <thead>
                                <tr><th colspan="2" class="xiongshu-header liuchong-header">六冲数组</th></tr>
                            </thead>
                            <tbody>
                                ${[
                                    ['1-7', '7-1'], ['8-2', '2-8'], ['3-9', '9-3'],
                                    ['10-4', '4-10'], ['11-5', '5-11'], ['12-6', '6-12']
                                ].map(row => `
                                    <tr>
                                        <td>${highlightCombinations.has(row[0]) ? `<span class="highlight-combination">${row[0]}</span>` : row[0]}</td>
                                        <td>${highlightCombinations.has(row[1]) ? `<span class="highlight-combination">${row[1]}</span>` : row[1]}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <table class="lookup-table">
                            <thead>
                                <tr><th colspan="2" class="xiongshu-header shuangmu-header">双木克土</th></tr>
                            </thead>
                            <tbody>
                                ${[
                                    ['3-8-4', '3-8-5'], ['3-9-4', '3-9-5'], ['4-3-4', '4-3-5'],
                                    ['4-8-5', '4-9-5'], ['4-8-4', '4-9-4'], ['5-8-5', '5-9-5'],
                                    ['5-3-5', '']
                                ].map(row => `
                                    <tr>
                                        <td>${highlightCombinations.has(row[0]) ? `<span class="highlight-combination">${row[0]}</span>` : row[0]}</td>
                                        <td>${row[1] && highlightCombinations.has(row[1]) ? `<span class="highlight-combination">${row[1]}</span>` : row[1]}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <table class="lookup-table">
                            <thead>
                                <tr><th class="xiongshu-header zhongliu-header">肿瘤数字</th></tr>
                            </thead>
                            <tbody>
                                ${[
                                    ['3-3'], ['3-9'], ['6-3'],
                                    ['7-3'], ['9-3'], ['9-9']
                                ].map(row => `
                                    <tr>
                                        <td>${highlightCombinations.has(row[0]) ? `<span class="highlight-combination">${row[0]}</span>` : row[0]}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function generateBaziTableHTML(upperGua, lowerGua) {
            // 生成八字排盘表格的HTML
            return `
                <table class="bazi-table">
                    <thead>
                        <tr>
                            <th>卦象</th>
                            <th>八字排盘</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>上卦</td>
                            <td>
                                <div class="pillar-container">
                                    ${generatePillarHTML(upperGua.year, '年柱')}
                                    <span class="horizontal-line"></span>
                                    ${generatePillarHTML(upperGua.month, '月柱')}
                                    <span class="horizontal-line"></span>
                                    ${upperGua.day.map(d => generatePillarHTML(d, '日柱')).join('<span class="horizontal-line"></span>')}
                                    <span class="horizontal-line"></span>
                                    ${generatePillarHTML(upperGua.hour, '时柱')}
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>下卦</td>
                            <td>
                                <div class="pillar-container">
                                    ${generatePillarHTML(lowerGua.year, '年柱')}
                                    <span class="horizontal-line"></span>
                                    ${generatePillarHTML(lowerGua.month, '月柱')}
                                    <span class="horizontal-line"></span>
                                    ${lowerGua.day.map(d => generatePillarHTML(d, '日柱')).join('<span class="horizontal-line"></span>')}
                                    <span class="horizontal-line"></span>
                                    ${generatePillarHTML(lowerGua.hour, '时柱')}
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            `;
        }

        function generatePillarHTML(number, label) {
            const element = getElementForNumber(number);
            const elementColor = getElementClass(element);
            return `
                <div class="pillar-group">
                    <span class="pillar-label">${label}</span>
                    <div class="pillar-item">
                        <span>${number}</span>
                        <span class="element-tag" style="background-color: ${elementColor}">${element}</span>
                    </div>
                </div>
            `;
        }

        function analyzeGua(gua, type) {
            let analyses = [];
            
            // 父母宫分析
            const parentPalace = analyzeRelation(gua.year, gua.month, '父母宫', type);
            analyses = analyses.concat(parentPalace);
            
            // 夫妻宫分析
            gua.day.forEach(dayNum => {
                const marriagePalace = analyzeRelation(gua.month, dayNum, '夫妻宫', type);
                analyses = analyses.concat(marriagePalace);
            });
            
            // 子女宫分析
            gua.day.forEach(dayNum => {
                const childPalace = analyzeRelation(dayNum, gua.hour, '子女宫', type);
                analyses = analyses.concat(childPalace);
            });
            
            return analyses.join('、');
        }

        function analyzeRelation(num1, num2, palace, guaType) {
            const issues = [];
            
            // 检查八绝
            if (baJue.some(pair => (pair[0] === num1 && pair[1] === num2) || (pair[0] === num2 && pair[1] === num1))) {
                issues.push(`${num1}-${num2}${palace}八绝`);
            }
            
            // 检查六冲
            if (liuChong.some(pair => (pair[0] === num1 && pair[1] === num2) || (pair[0] === num2 && pair[1] === num1))) {
                issues.push(`${num1}-${num2}${palace}六冲`);
            }
            
            // 检查肿瘤数字
            if (zhongLiu.some(pair => (pair[0] === num1 && pair[1] === num2) || (pair[0] === num2 && pair[1] === num1))) {
                issues.push(`${num1}-${num2}${palace}肿瘤数`);
            }
            
            // 五行相克分析
            const element1 = getElementForNumber(num1);
            const element2 = getElementForNumber(num2);
            const 克关系 = analyzeElementRelation(element1, element2);
            if (克关系) {
                issues.push(`${num1}-${num2}${palace}${克关系}`);
            }
            
            return issues;
        }

        function analyzeElementRelation(elem1, elem2) {
            const keRelations = {
                '木': '土', '火': '金', '土': '水', '金': '木', '水': '火'
            };
            
            if (keRelations[elem1] === elem2) {
                return `${elem1}克${elem2}`;
            }
            if (keRelations[elem2] === elem1) {
                return `${elem2}克${elem1}`;
            }
            return null;
        }

        function displayResults(year, zodiacIndex, upperGua, lowerGua) {
            const day = parseInt(document.getElementById('day').value);
            const zodiac = zodiacData[zodiacIndex];
            
            // 分析上下卦
            const upperAnalyses = analyzeGua(upperGua, '上卦');
            const lowerAnalyses = analyzeGua(lowerGua, '下卦');

            // 收集所有需要高亮的数字组合
            const highlightCombinations = new Set();
            const allAnalyses = [upperAnalyses, lowerAnalyses].filter(Boolean);
            
            allAnalyses.forEach(analysis => {
                const matches = analysis.match(/\d+-\d+(?:-\d+)?/g) || [];
                matches.forEach(match => highlightCombinations.add(match));
            });

            // 五行分析
            const allNumbers = [
                upperGua.year, upperGua.month, ...upperGua.day, upperGua.hour,
                lowerGua.year, lowerGua.month, ...lowerGua.day, lowerGua.hour
            ];
            const allElements = allNumbers.map(num => getElementForNumber(num));
            const elementAnalyses = [];
            if (!allElements.includes('土')) {
                elementAnalyses.push('五行缺土，没有财库');
            }
            if (!allElements.includes('金')) {
                elementAnalyses.push('五行缺金，财运受阻');
            }

            // 根据日期生成不同的表头和内容
            let tableHeadersHTML = '';
            let upperGuaRowHTML = '';
            let lowerGuaRowHTML = '';

            // 创建柱子显示
            function createPillarDisplay(number, element, label) {
                const elementColor = getElementClass(element);
                return `
                    <div class="pillar-group">
                        <span class="pillar-label">${label}</span>
                        <div class="pillar-item">
                            <span>${number}</span>
                            <span class="element-tag" style="background-color: ${elementColor}">${element}</span>
                        </div>
                    </div>
                `;
            }

            if (day <= 12) {
                tableHeadersHTML = `
                    <th>卦象</th>
                    <th>八字排盘</th>
                `;
                
                // 创建上卦行
                const upperYearElement = getElementForNumber(upperGua.year);
                const upperMonthElement = getElementForNumber(upperGua.month);
                const upperDayElement = getElementForNumber(upperGua.day[0]);
                const upperHourElement = getElementForNumber(upperGua.hour);

                upperGuaRowHTML = `
                    <td>上卦</td>
                    <td>
                        <div class="pillar-container">
                            ${createPillarDisplay(upperGua.year, upperYearElement, '年柱')}
                            <span class="horizontal-line"></span>
                            ${createPillarDisplay(upperGua.month, upperMonthElement, '月柱')}
                            <span class="horizontal-line"></span>
                            ${createPillarDisplay(upperGua.day[0], upperDayElement, '日柱')}
                            <span class="horizontal-line"></span>
                            ${createPillarDisplay(upperGua.hour, upperHourElement, '时柱')}
                        </div>
                    </td>`;

                // 创建下卦行
                const lowerYearElement = getElementForNumber(lowerGua.year);
                const lowerMonthElement = getElementForNumber(lowerGua.month);
                const lowerDayElement = getElementForNumber(lowerGua.day[0]);
                const lowerHourElement = getElementForNumber(lowerGua.hour);

                lowerGuaRowHTML = `
                    <td>下卦</td>
                    <td>
                        <div class="pillar-container">
                            ${createPillarDisplay(lowerGua.year, lowerYearElement, '年柱')}
                            <span class="horizontal-line"></span>
                            ${createPillarDisplay(lowerGua.month, lowerMonthElement, '月柱')}
                            <span class="horizontal-line"></span>
                            ${createPillarDisplay(lowerGua.day[0], lowerDayElement, '日柱')}
                            <span class="horizontal-line"></span>
                            ${createPillarDisplay(lowerGua.hour, lowerHourElement, '时柱')}
                        </div>
                    </td>`;
            } else {
                tableHeadersHTML = `
                    <th>卦象</th>
                    <th>八字排盘</th>
                `;
                
                let upperDayPillars = upperGua.day.map(d => createPillarDisplay(d, getElementForNumber(d), '日柱')).join('<div class="horizontal-line"></div>');
                upperGuaRowHTML = `
                    <td>上卦</td>
                    <td>
                        <div class="pillar-container">
                            ${createPillarDisplay(upperGua.year, getElementForNumber(upperGua.year), '年柱')}
                            <div class="horizontal-line"></div>
                            ${createPillarDisplay(upperGua.month, getElementForNumber(upperGua.month), '月柱')}
                            <div class="horizontal-line"></div>
                            ${upperDayPillars}
                            <div class="horizontal-line"></div>
                            ${createPillarDisplay(upperGua.hour, getElementForNumber(upperGua.hour), '时柱')}
                        </div>
                    </td>`;
                
                let lowerDayPillars = lowerGua.day.map(d => createPillarDisplay(d, getElementForNumber(d), '日柱')).join('<div class="horizontal-line"></div>');
                lowerGuaRowHTML = `
                    <td>下卦</td>
                    <td>
                        <div class="pillar-container">
                            ${createPillarDisplay(lowerGua.year, getElementForNumber(lowerGua.year), '年柱')}
                            <div class="horizontal-line"></div>
                            ${createPillarDisplay(lowerGua.month, getElementForNumber(lowerGua.month), '月柱')}
                            <div class="horizontal-line"></div>
                            ${lowerDayPillars}
                            <div class="horizontal-line"></div>
                            ${createPillarDisplay(lowerGua.hour, getElementForNumber(lowerGua.hour), '时柱')}
                        </div>
                    </td>`;
            }
            
            const resultHTML = `
                <div class="result-card">
                    <h3>🎯 ${originalDate}</h3>
                    <div class="zodiac-info">
                        <span class="zodiac-emoji">${zodiac.emoji}</span>
                        <div>
                            <strong>${year}年生人</strong><br>
                            <span style="color: #666;">生肖：${zodiac.name}（排名：${zodiacIndex}）</span>
                        </div>
                    </div>
                </div>

                <div class="result-card">
                    <h3>📊 八字排盘</h3>
                    <table class="bazi-table">
                        <thead>
                            <tr>
                                ${tableHeadersHTML}
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                ${upperGuaRowHTML}
                            </tr>
                            <tr>
                                ${lowerGuaRowHTML}
                            </tr>
                        </tbody>
                    </table>
                     <div class="analysis-summary" style="padding: 15px 25px; text-align: left; line-height: 1.8;">
                        ${upperAnalyses ? `<p style="color: #c9302c;"><strong>上卦：</strong> ${upperAnalyses}</p>` : ''}
                        ${lowerAnalyses ? `<p style="color: #c9302c;"><strong>下卦：</strong> ${lowerAnalyses}</p>` : ''}
                        ${elementAnalyses.length > 0 ? `<p style="color: #c9302c;"><strong>五行分析：</strong> ${elementAnalyses.join('、')}</p>` : ''}
                        ${!upperAnalyses && !lowerAnalyses && elementAnalyses.length === 0 ? '<div class="analysis-item positive" style="text-align:center;">✨ 八字平和，无明显冲克</div>' : ''}
                </div>
                    <div class="time-reference" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
                        <div style="display: flex; gap: 5px;">
                            <table class="lookup-table" style="flex: 1;">
                                <thead>
                                    <tr>
                                        <th colspan="2" class="xiongshu-header bajue-header">八绝数组</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${[
                                        ['1-8', '8-1'], ['1-9', '9-1'], ['6-2', '2-6'],
                                        ['3-5', '5-3'], ['3-6', '6-3'], ['4-10', '10-4'],
                                        ['11-7', '7-11'], ['7-12', '12-7']
                                    ].map(row => `
                                        <tr>
                                            <td>${highlightCombinations.has(row[0]) ? `<span class="highlight-combination">${row[0]}</span>` : row[0]}</td>
                                            <td>${highlightCombinations.has(row[1]) ? `<span class="highlight-combination">${row[1]}</span>` : row[1]}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                            <table class="lookup-table" style="flex: 1;">
                                <thead>
                                    <tr>
                                        <th colspan="2" class="xiongshu-header liuchong-header">六冲数组</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${[
                                        ['1-7', '7-1'], ['8-2', '2-8'], ['3-9', '9-3'],
                                        ['10-4', '4-10'], ['11-5', '5-11'], ['12-6', '6-12']
                                    ].map(row => `
                                        <tr>
                                            <td>${highlightCombinations.has(row[0]) ? `<span class="highlight-combination">${row[0]}</span>` : row[0]}</td>
                                            <td>${highlightCombinations.has(row[1]) ? `<span class="highlight-combination">${row[1]}</span>` : row[1]}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                            <table class="lookup-table" style="flex: 1;">
                                <thead>
                                    <tr>
                                        <th colspan="2" class="xiongshu-header shuangmu-header">双木克土</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${[
                                        ['3-8-4', '3-8-5'], ['3-9-4', '3-9-5'], ['4-3-4', '4-3-5'],
                                        ['4-8-5', '4-9-5'], ['4-8-4', '4-9-4'], ['5-8-5', '5-9-5'],
                                        ['5-3-5', '']
                                    ].map(row => `
                                        <tr>
                                            <td>${highlightCombinations.has(row[0]) ? `<span class="highlight-combination">${row[0]}</span>` : row[0]}</td>
                                            <td>${row[1] && highlightCombinations.has(row[1]) ? `<span class="highlight-combination">${row[1]}</span>` : row[1]}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;

            // 将生成的HTML字符串设置为结果卡片的innerHTML
            const resultCard = document.createElement('div');
            resultCard.className = 'result-card';
            resultCard.innerHTML = resultHTML;
            resultGrid.appendChild(resultCard);
        }
    </script>
    <script src="auth.js"></script>
</body>
</html>